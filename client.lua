local BodyParts = {{
    Name = 'Everything',
    Damaged = false,
    Part = 0,
    BoneID = 0,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_Pelvis',
    Damaged = false,
    Part = 2,
    BoneID = 11816,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_L_Thigh',
    Damaged = false,
    Part = 3,
    BoneID = 58271,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_L_Calf',
    Damaged = false,
    Part = 4,
    BoneID = 63931,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_L_Foot',
    Damaged = false,
    Part = 5,
    BoneID = 14201,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'IK_L_Foot',
    Damaged = false,
    Part = 7,
    BoneID = 65245,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'PH_L_Foot',
    Damaged = false,
    Part = 8,
    BoneID = 57717,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'MH_L_Knee',
    Damaged = false,
    Part = 9,
    BoneID = 46078,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_R_Thigh',
    Damaged = false,
    Part = 10,
    BoneID = 51826,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_R_Calf',
    Damaged = false,
    Part = 11,
    BoneID = 36864,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_R_Foot',
    Damaged = false,
    Part = 12,
    BoneID = 52301,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'IK_R_Foot',
    Damaged = false,
    Part = 14,
    BoneID = 35502,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'PH_R_Foot',
    Damaged = false,
    Part = 15,
    BoneID = 24806,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'MH_R_Knee',
    Damaged = false,
    Part = 16,
    BoneID = 16335,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'RB_L_ThighRoll',
    Damaged = false,
    Part = 17,
    BoneID = 23639,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'RB_R_ThighRoll',
    Damaged = false,
    Part = 18,
    BoneID = 6442,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_Spine_Root',
    Damaged = false,
    Part = 19,
    BoneID = 57597,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_Spine0',
    Damaged = false,
    Part = 20,
    BoneID = 23553,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_Spine1',
    Damaged = false,
    Part = 21,
    BoneID = 24816,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_Spine2',
    Damaged = false,
    Part = 22,
    BoneID = 24817,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_Spine3',
    Damaged = false,
    Part = 23,
    BoneID = 24818,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_L_Clavicle',
    Damaged = false,
    Part = 24,
    BoneID = 64729,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_L_UpperArm',
    Damaged = false,
    Part = 25,
    BoneID = 45509,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_L_Forearm',
    Damaged = false,
    Part = 26,
    BoneID = 61163,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_L_Hand',
    Damaged = false,
    Part = 27,
    BoneID = 18905,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'PH_L_Hand',
    Damaged = false,
    Part = 28,
    BoneID = 60309,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'IK_L_Hand',
    Damaged = false,
    Part = 29,
    BoneID = 36029,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'MH_L_Elbow',
    Damaged = false,
    Part = 30,
    BoneID = 22711,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_R_Clavicle',
    Damaged = false,
    Part = 31,
    BoneID = 10706,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_R_UpperArm',
    Damaged = false,
    Part = 32,
    BoneID = 40269,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_R_Forearm',
    Damaged = false,
    Part = 33,
    BoneID = 28252,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_R_Hand',
    Damaged = false,
    Part = 34,
    BoneID = 57005,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'PH_R_Hand',
    Damaged = false,
    Part = 35,
    BoneID = 58866,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'IK_R_Hand',
    Damaged = false,
    Part = 36,
    BoneID = 6286,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'RB_R_ForeArmRoll',
    Damaged = false,
    Part = 37,
    BoneID = 43810,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'RB_R_ArmRoll',
    Damaged = false,
    Part = 38,
    BoneID = 37119,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'MH_R_Elbow',
    Damaged = false,
    Part = 39,
    BoneID = 2992,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_Neck_1',
    Damaged = false,
    Part = 40,
    BoneID = 39317,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'SKEL_Head',
    Damaged = false,
    Part = 41,
    BoneID = 31086,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'IK_Head',
    Damaged = false,
    Part = 42,
    BoneID = 12844,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FACIAL_facialRoot',
    Damaged = false,
    Part = 43,
    BoneID = 65068,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_L_Brow_Out_000',
    Damaged = false,
    Part = 44,
    BoneID = 58331,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_L_Lid_Upper_000',
    Damaged = false,
    Part = 45,
    BoneID = 45750,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_L_Eye_000',
    Damaged = false,
    Part = 46,
    BoneID = 25260,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_L_CheekBone_000',
    Damaged = false,
    Part = 47,
    BoneID = 21550,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_L_Lip_Corner_000',
    Damaged = false,
    Part = 48,
    BoneID = 29868,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_R_Lid_Upper_000',
    Damaged = false,
    Part = 49,
    BoneID = 43536,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_R_Eye_000',
    Damaged = false,
    Part = 50,
    BoneID = 27474,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_R_CheekBone_000',
    Damaged = false,
    Part = 51,
    BoneID = 19336,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_R_Brow_Out_000',
    Damaged = false,
    Part = 52,
    BoneID = 1356,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_R_Lip_Corner_000',
    Damaged = false,
    Part = 53,
    BoneID = 11174,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_Brow_Centre_000',
    Damaged = false,
    Part = 54,
    BoneID = 37193,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_UpperLipRoot_000',
    Damaged = false,
    Part = 55,
    BoneID = 20178,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_UpperLip_000',
    Damaged = false,
    Part = 56,
    BoneID = 61839,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_L_Lip_Top_000',
    Damaged = false,
    Part = 57,
    BoneID = 20279,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_R_Lip_Top_000',
    Damaged = false,
    Part = 58,
    BoneID = 17719,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_Jaw_000',
    Damaged = false,
    Part = 59,
    BoneID = 46240,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_LowerLipRoot_000',
    Damaged = false,
    Part = 60,
    BoneID = 17188,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_LowerLip_000',
    Damaged = false,
    Part = 61,
    BoneID = 20623,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_L_Lip_Bot_000',
    Damaged = false,
    Part = 62,
    BoneID = 47419,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_R_Lip_Bot_000',
    Damaged = false,
    Part = 63,
    BoneID = 49979,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'FB_Tongue_000',
    Damaged = false,
    Part = 64,
    BoneID = 47495,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'RB_Neck_1',
    Damaged = false,
    Part = 65,
    BoneID = 35731,
    Severity = 0,
    DamageType = {}
}, {
    Name = 'IK_Root',
    Damaged = false,
    Part = 66,
    BoneID = 56604,
    Severity = 0,
    DamageType = {}
}}

local weapons = { --[[ Small Caliber ]] --
{
    Name = 'WEAPON_PISTOL',
    WeaponClasses = 'SMALL_CALIBER'
}, {
    Name = 'WEAPON_COMBATPISTOL',
    WeaponClasses = 'SMALL_CALIBER'
}, {
    Name = 'WEAPON_APPISTOL',
    WeaponClasses = 'SMALL_CALIBER'
}, {
    Name = 'WEAPON_COMBATPDW',
    WeaponClasses = 'SMALL_CALIBER'
}, {
    Name = 'WEAPON_MACHINEPISTOL',
    WeaponClasses = 'SMALL_CALIBER'
}, {
    Name = 'WEAPON_MICROSMG',
    WeaponClasses = 'SMALL_CALIBER'
}, {
    Name = 'WEAPON_MINISMG',
    WeaponClasses = 'SMALL_CALIBER'
}, {
    Name = 'WEAPON_PISTOL_MK2',
    WeaponClasses = 'SMALL_CALIBER'
}, {
    Name = 'WEAPON_SNSPISTOL',
    WeaponClasses = 'SMALL_CALIBER'
}, {
    Name = 'WEAPON_SNSPISTOL_MK2',
    WeaponClasses = 'SMALL_CALIBER'
}, {
    Name = 'WEAPON_VINTAGEPISTOL',
    WeaponClasses = 'SMALL_CALIBER'
}, --[[ Medium Caliber ]] --
{
    Name = 'WEAPON_ADVANCEDRIFLE',
    WeaponClasses = 'MEDIUM_CALIBER'
}, {
    Name = 'WEAPON_ASSAULTSMG',
    WeaponClasses = 'MEDIUM_CALIBER'
}, {
    Name = 'WEAPON_BULLPUPRIFLE',
    WeaponClasses = 'MEDIUM_CALIBER'
}, {
    Name = 'WEAPON_BULLPUPRIFLE_MK2',
    WeaponClasses = 'MEDIUM_CALIBER'
}, {
    Name = 'WEAPON_CARBINERIFLE',
    WeaponClasses = 'MEDIUM_CALIBER'
}, {
    Name = 'WEAPON_CARBINERIFLE_MK2',
    WeaponClasses = 'MEDIUM_CALIBER'
}, {
    Name = 'WEAPON_COMPACTRIFLE',
    WeaponClasses = 'MEDIUM_CALIBER'
}, {
    Name = 'WEAPON_DOUBLEACTION',
    WeaponClasses = 'MEDIUM_CALIBER'
}, {
    Name = 'WEAPON_GUSENBERG',
    WeaponClasses = 'MEDIUM_CALIBER'
}, {
    Name = 'WEAPON_HEAVYPISTOL',
    WeaponClasses = 'MEDIUM_CALIBER'
}, {
    Name = 'WEAPON_MARKSMANPISTOL',
    WeaponClasses = 'MEDIUM_CALIBER'
}, {
    Name = 'WEAPON_PISTOL50',
    WeaponClasses = 'MEDIUM_CALIBER'
}, {
    Name = 'WEAPON_REVOLVER',
    WeaponClasses = 'MEDIUM_CALIBER'
}, {
    Name = 'WEAPON_REVOLVER_MK2',
    WeaponClasses = 'MEDIUM_CALIBER'
}, {
    Name = 'WEAPON_SMG',
    WeaponClasses = 'MEDIUM_CALIBER'
}, {
    Name = 'WEAPON_SMG_MK2',
    WeaponClasses = 'MEDIUM_CALIBER'
}, {
    Name = 'WEAPON_SPECIALCARBINE',
    WeaponClasses = 'MEDIUM_CALIBER'
}, {
    Name = 'WEAPON_SPECIALCARBINE_MK2',
    WeaponClasses = 'MEDIUM_CALIBER'
}, --[[ High Caliber ]] --
{
    Name = 'WEAPON_ASSAULTRIFLE',
    WeaponClasses = 'HIGH_CALIBER'
}, {
    Name = 'WEAPON_ASSAULTRIFLE_MK2',
    WeaponClasses = 'HIGH_CALIBER'
}, {
    Name = 'WEAPON_COMBATMG',
    WeaponClasses = 'HIGH_CALIBER'
}, {
    Name = 'WEAPON_COMBATMG_MK2',
    WeaponClasses = 'HIGH_CALIBER'
}, {
    Name = 'WEAPON_HEAVYSNIPER',
    WeaponClasses = 'HIGH_CALIBER'
}, {
    Name = 'WEAPON_HEAVYSNIPER_MK2',
    WeaponClasses = 'HIGH_CALIBER'
}, {
    Name = 'WEAPON_MARKSMANRIFLE',
    WeaponClasses = 'HIGH_CALIBER'
}, {
    Name = 'WEAPON_MARKSMANRIFLE_MK2',
    WeaponClasses = 'HIGH_CALIBER'
}, {
    Name = 'WEAPON_MG',
    WeaponClasses = 'HIGH_CALIBER'
}, {
    Name = 'WEAPON_MINIGUN',
    WeaponClasses = 'HIGH_CALIBER'
}, {
    Name = 'WEAPON_MUSKET',
    WeaponClasses = 'HIGH_CALIBER'
}, {
    Name = 'WEAPON_RAILGUN',
    WeaponClasses = 'HIGH_CALIBER'
}, --[[ Shotguns ]] --
{
    Name = 'WEAPON_ASSAULTSHOTGUN',
    WeaponClasses = 'SHOTGUN'
}, {
    Name = 'WEAPON_BULLUPSHOTGUN',
    WeaponClasses = 'SHOTGUN'
}, {
    Name = 'WEAPON_DBSHOTGUN',
    WeaponClasses = 'SHOTGUN'
}, {
    Name = 'WEAPON_HEAVYSHOTGUN',
    WeaponClasses = 'SHOTGUN'
}, {
    Name = 'WEAPON_PUMPSHOTGUN',
    WeaponClasses = 'SHOTGUN'
}, {
    Name = 'WEAPON_PUMPSHOTGUN_MK2',
    WeaponClasses = 'SHOTGUN'
}, {
    Name = 'WEAPON_SAWNOFFSHOTGUN',
    WeaponClasses = 'SHOTGUN'
}, {
    Name = 'WEAPON_SWEEPERSHOTGUN',
    WeaponClasses = 'SHOTGUN'
}, --[[ Animals ]] --
{
    Name = 'WEAPON_ANIMAL',
    WeaponClasses = 'WILDLIFE'
}, {
    Name = 'WEAPON_COUGAR',
    WeaponClasses = 'WILDLIFE'
}, {
    Name = 'WEAPON_BARBED_WIRE',
    WeaponClasses = 'WILDLIFE'
}, --[[ Cutting Weapons ]] --
{
    Name = 'WEAPON_BATTLEAXE',
    WeaponClasses = 'CUTTING'
}, {
    Name = 'WEAPON_BOTTLE',
    WeaponClasses = 'CUTTING'
}, {
    Name = 'WEAPON_DAGGER',
    WeaponClasses = 'CUTTING'
}, {
    Name = 'WEAPON_HATCHET',
    WeaponClasses = 'CUTTING'
}, {
    Name = 'WEAPON_KNIFE',
    WeaponClasses = 'CUTTING'
}, {
    Name = 'WEAPON_MACHETE',
    WeaponClasses = 'CUTTING'
}, {
    Name = 'WEAPON_SWITCHBLADE',
    WeaponClasses = 'CUTTING'
}, {
    Name = 'WEAPON_HATCHET',
    WeaponClasses = 'CUTTING'
}, --[[ Light Impact ]] --
{
    Name = 'WEAPON_BALL',
    WeaponClasses = 'LIGHT_IMPACT'
}, {
    Name = 'WEAPON_FLASHLIGHT',
    WeaponClasses = 'LIGHT_IMPACT'
}, {
    Name = 'WEAPON_KNUCKLE',
    WeaponClasses = 'LIGHT_IMPACT'
}, {
    Name = 'WEAPON_GARBAGEBAG',
    WeaponClasses = 'LIGHT_IMPACT'
}, {
    Name = 'WEAPON_BRIEFCASE',
    WeaponClasses = 'LIGHT_IMPACT'
}, {
    Name = 'WEAPON_BRIEFCASE_02',
    WeaponClasses = 'LIGHT_IMPACT'
}, {
    Name = 'WEAPON_NIGHTSTICK',
    WeaponClasses = 'LIGHT_IMPACT'
}, {
    Name = 'WEAPON_SNOWBALL',
    WeaponClasses = 'LIGHT_IMPACT'
}, {
    Name = 'WEAPON_UNARMED',
    WeaponClasses = 'LIGHT_IMPACT'
}, {
    Name = 'WEAPON_PARACHUTE',
    WeaponClasses = 'LIGHT_IMPACT'
}, {
    Name = 'WEAPON_NIGHTVISION',
    WeaponClasses = 'LIGHT_IMPACT'
}, --[[ Heavy Impact ]] --
{
    Name = 'WEAPON_BAT',
    WeaponClasses = 'HEAVY_IMPACT'
}, {
    Name = 'WEAPON_CROWBAR',
    WeaponClasses = 'HEAVY_IMPACT'
}, {
    Name = 'WEAPON_FIREEXTINGUISHER',
    WeaponClasses = 'HEAVY_IMPACT'
}, {
    Name = 'WEAPON_FIRWORK',
    WeaponClasses = 'HEAVY_IMPACT'
}, {
    Name = 'WEAPON_GOLFLCUB',
    WeaponClasses = 'HEAVY_IMPACT'
}, {
    Name = 'WEAPON_HAMMER',
    WeaponClasses = 'HEAVY_IMPACT'
}, {
    Name = 'WEAPON_PETROLCAN',
    WeaponClasses = 'HEAVY_IMPACT'
}, {
    Name = 'WEAPON_POOLCUE',
    WeaponClasses = 'HEAVY_IMPACT'
}, {
    Name = 'WEAPON_WRENCH',
    WeaponClasses = 'HEAVY_IMPACT'
}, --[[ Explosives ]] --
{
    Name = 'WEAPON_EXPLOSION',
    WeaponClasses = 'EXPLOSIVE'
}, {
    Name = 'WEAPON_GRENADE',
    WeaponClasses = 'EXPLOSIVE'
}, {
    Name = 'WEAPON_COMPACTLAUNCHER',
    WeaponClasses = 'EXPLOSIVE'
}, {
    Name = 'WEAPON_HOMINGLAUNCHER',
    WeaponClasses = 'EXPLOSIVE'
}, {
    Name = 'WEAPON_PIPEBOMB',
    WeaponClasses = 'EXPLOSIVE'
}, {
    Name = 'WEAPON_PROXMINE',
    WeaponClasses = 'EXPLOSIVE'
}, {
    Name = 'WEAPON_RPG',
    WeaponClasses = 'Głośniczek Komendatna'
}, {
    Name = 'WEAPON_STICKYBOMB',
    WeaponClasses = 'EXPLOSIVE'
}, --[[ Other ]] --
{
    Name = 'WEAPON_FALL',
    WeaponClasses = 'SCRATCHES & IMPACT'
}, {
    Name = 'WEAPON_HIT_BY_WATER_CANNON',
    WeaponClasses = 'HEAVY_IMPACT'
}, {
    Name = 'WEAPON_RAMMED_BY_CAR',
    WeaponClasses = 'VERY_HEAVY_IMPACT'
}, {
    Name = 'WEAPON_RUN_OVER_BY_CAR',
    WeaponClasses = 'VERY_HEAVY_IMPACT'
}, {
    Name = 'WEAPON_HELI_CRASH',
    WeaponClasses = 'VERY_HEAVY_IMPACT'
}, {
    Name = 'WEAPON_STUNGUN',
    WeaponClasses = 'LIGHT_ELECTRIC'
}, --[[ Fire ]] --
{
    Name = 'WEAPON_ELECTRIC_FENCE',
    WeaponClasses = 'MEDIUM_ELECTRIC'
}, {
    Name = 'WEAPON_FIRE',
    WeaponClasses = 'FIRE'
}, {
    Name = 'WEAPON_MOLOTOV',
    WeaponClasses = 'FIRE'
}, {
    Name = 'WEAPON_FLARE',
    WeaponClasses = 'FIRE'
}, {
    Name = 'WEAPON_FLAREGUN',
    WeaponClasses = 'FIRE'
}, --[[ Suffocate ]] --
{
    Name = 'WEAPON_DROWNING',
    WeaponClasses = 'SUFFOCATING'
}, {
    Name = 'WEAPON_DROWNING_IN_VEHICLE',
    WeaponClasses = 'SUFFOCATING'
}, {
    Name = 'WEAPON_EXHAUSTION',
    WeaponClasses = 'SUFFOCATING'
}, {
    Name = 'WEAPON_BZGAS',
    WeaponClasses = 'SUFFOCATING'
}, {
    Name = 'WEAPON_SMOKEGRENADE',
    WeaponClasses = 'SUFFOCATING'
}}

Health = {
    Player = {
        Health = GetEntityHealth(PlayerPed)
    }
}

function getInjuries()
    local Injuries = {}
    for _, BodyPart in pairs(BodyParts) do
        if BodyPart.Damaged then
            table.insert(Injuries, BodyPart)
        end
    end
    return Injuries
end

RegisterNetEvent('esx_injuries:healallinjuries')
AddEventHandler('esx_injuries:healallinjuries', function()
    for _, BodyPart in pairs(BodyParts) do
        BodyPart.Damaged = false
        BodyPart.DamageType = nil
    end
end)

RegisterNetEvent('esx_injuries:setInjuredBodyParts')
AddEventHandler('esx_injuries:setInjuredBodyParts', function(Injuries)
    print("Setting injured body parts")
    for _, BodyPart in pairs(BodyParts) do
        for _, Injury in pairs(Injuries) do
            if BodyPart.Name == Injury.Name then
                BodyPart.Damaged = true
                BodyPart.DamageType = Injury.DamageType
            end
        end
    end
end)

Citizen.CreateThread(function()
    while true do
        Citizen.Wait(0)
        local PlayerPed = PlayerPedId()
        local PlayerPosition = GetEntityCoords(PlayerPed, false)
        local PlayerHealth = GetEntityHealth(PlayerPed)
        if Health.Player.Health ~= PlayerHealth then
            local _, DamagedBone = GetPedLastDamageBone(PlayerPed)
            print("Damaged bone: " .. DamagedBone)
            for _, BodyPart in pairs(BodyParts) do
                if BodyPart.BoneID == DamagedBone then
                    local weaponclass = GetDamageType(PlayerPed)
                    if (weaponclass ~= nil) then
                        print("Damaged body part: " .. BodyPart.Name)
                        if BodyPart.Damaged == false then
                            BodyPart.Damaged = true
                            table.insert(BodyPart.DamageType, weaponclass)
                            print(BodyPart.Name .. " is damaged by " .. weaponclass)
                            TriggerServerEvent('esx_injuries:saveInjuredBodyParts', getInjuries())
                        end
                    end
                end
            end
            Health.Player.Health = PlayerHealth
        end
    end
end)

function GetDamageType(ped)
    for k, v in pairs(weapons) do
        if HasPedBeenDamagedByWeapon(ped, v.Name, 0) then
            ClearEntityLastDamageEntity(ped)
            return v.WeaponClasses
        end
    end
end

local display = false

function SetDisplay(bool, BodyParts)
    display = bool
    SetNuiFocus(bool, bool)
    SendNUIMessage({
        type = "ui",
        display = bool,
        injuries = BodyParts
    })
end

RegisterNUICallback('closeUi', function(data, cb)
    SetDisplay(false)
end)

RegisterNetEvent('esx_injuries:OpenInjuryWindow')
AddEventHandler('esx_injuries:OpenInjuryWindow', function(BodyParts)
    print("WNDOW")
    SetDisplay(true, BodyParts)
end)

RegisterNetEvent('esx_injuries:CloseInjuryWindow')
AddEventHandler('esx_injuries:CloseInjuryWindow', function(BodyParts)
    SetDisplay(false)
end)

RegisterNUICallback("exit", function(data)
    SetDisplay(false)
end)

RegisterNUICallback("main", function(data)
    SetDisplay(false)
end)

RegisterNUICallback("error", function(data)
    print(data.error)
    SetDisplay(false)
end)

Citizen.CreateThread(function()
    while display do
        Citizen.Wait(0)
        DisableControlAction(0, 1, display) -- LookLeftRight
        DisableControlAction(0, 2, display) -- LookUpDown
        DisableControlAction(0, 24, display) -- Attack
        DisablePlayerFiring(PlayerPedId(), display) -- Disable weapon firing
        DisableControlAction(0, 142, display) -- MeleeAttackAlternate
        DisableControlAction(0, 106, display) -- VehicleMouseControlOverride
        DisableControlAction(0, 18, display) -- Enter
        DisableControlAction(0, 322, display) -- ESC
        DisableControlAction(0, 106, display) -- VehicleMouseControlOverride
    end
end)
